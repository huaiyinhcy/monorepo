import{b9 as v,a4 as E,a2 as T,a1 as G,aB as S,ba as b,av as q,aE as L,ao as m,au as R,as as F,aq as k,ap as O,at as I,ar as P,aD as Y,aF as J,ay as D,az as A,bb as u,a7 as M,bc as X,S as Z,bd as V}from"./index.BR2auVMv.js";class H{drawCustom(t,e,i,s,a){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class z extends H{constructor(t,e,i,s,a,n,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?v(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=a,this.squaredTolerance_=n,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=E()}drawImages_(t,e,i,s){if(!this.image_)return;const a=T(t,e,i,s,this.transform_,this.pixelCoordinates_),n=this.context_,o=this.tmpLocalTransform_,l=n.globalAlpha;this.imageOpacity_!=1&&(n.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,f=a.length;c<f;c+=2){const x=a[c]-this.imageAnchorX_,g=a[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const d=x+this.imageAnchorX_,_=g+this.imageAnchorY_;G(o,d,_,1,1,h,-d,-_),n.save(),n.transform.apply(n,o),n.translate(d,_),n.scale(this.imageScale_[0],this.imageScale_[1]),n.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),n.restore()}else n.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,x,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(n.globalAlpha=l)}drawText_(t,e,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const a=T(t,e,i,s,this.transform_,this.pixelCoordinates_),n=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=s){const l=a[e]+this.textOffsetX_,h=a[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(n.save(),n.translate(l-this.textOffsetX_,h-this.textOffsetY_),n.rotate(o),n.translate(this.textOffsetX_,this.textOffsetY_),n.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&n.strokeText(this.text_,0,0),this.textFillState_&&n.fillText(this.text_,0,0),n.restore()):(this.textStrokeState_&&n.strokeText(this.text_,l,h),this.textFillState_&&n.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,s,a){const n=this.context_,o=T(t,e,i,s,this.transform_,this.pixelCoordinates_);n.moveTo(o[0],o[1]);let l=o.length;a&&(l-=2);for(let h=2;h<l;h+=2)n.lineTo(o[h],o[h+1]);return a&&n.closePath(),i}drawRings_(t,e,i,s){for(let a=0,n=i.length;a<n;++a)e=this.moveToLineTo_(t,e,i[a],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!S(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=b(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],a=Math.sqrt(i*i+s*s),n=this.context_;n.beginPath(),n.arc(e[0],e[1],a,0,2*Math.PI),this.fillState_&&n.fill(),this.strokeState_&&n.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,s=e.length;i<s;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!S(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(S(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=t.getFlatCoordinates();let a=0;const n=t.getEnds(),o=t.getStride();i.beginPath();for(let l=0,h=n.length;l<h;++l)a=this.moveToLineTo_(s,a,n[l],o,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!S(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!S(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const a=t.getEndss(),n=t.getStride();e.beginPath();for(let o=0,l=a.length;o<l;++o){const h=a[o];s=this.drawRings_(i,s,h,n)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),q(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:L;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:m(i||D)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),s=e.getLineCap(),a=e.getLineDash(),n=e.getLineDashOffset(),o=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=a||k;this.strokeState_={lineCap:s!==void 0?s:O,lineDash:this.pixelRatio_===1?c:c.map(f=>f*this.pixelRatio_),lineDashOffset:(n||P)*this.pixelRatio_,lineJoin:o!==void 0?o:F,lineWidth:(l!==void 0?l:I)*this.pixelRatio_,miterLimit:h!==void 0?h:R,strokeStyle:m(i||A)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),a=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=a[0],this.imageOriginY_=a[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const n=t.getScaleArray();this.imageScale_=[n[0]*this.pixelRatio_/i,n[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const g=e.getColor();this.textFillState_={fillStyle:m(g||D)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const g=i.getColor(),d=i.getLineCap(),_=i.getLineDash(),p=i.getLineDashOffset(),y=i.getLineJoin(),w=i.getWidth(),C=i.getMiterLimit();this.textStrokeState_={lineCap:d!==void 0?d:O,lineDash:_||k,lineDashOffset:p||P,lineJoin:y!==void 0?y:F,lineWidth:w!==void 0?w:I,miterLimit:C!==void 0?C:R,strokeStyle:m(g||A)}}const s=t.getFont(),a=t.getOffsetX(),n=t.getOffsetY(),o=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),f=t.getTextAlign(),x=t.getTextBaseline();this.textState_={font:s!==void 0?s:J,textAlign:f!==void 0?f:L,textBaseline:x!==void 0?x:Y},this.text_=c!==void 0?Array.isArray(c)?c.reduce((g,d,_)=>g+=_%2?" ":d,""):c:"",this.textOffsetX_=a!==void 0?this.pixelRatio_*a:0,this.textOffsetY_=n!==void 0?this.pixelRatio_*n:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const N=.5,W={Point:nt,LineString:tt,Polygon:ot,MultiPoint:st,MultiLineString:et,MultiPolygon:it,GeometryCollection:Q,Circle:j};function ct(r,t){return parseInt(M(r),10)-parseInt(M(t),10)}function U(r,t){const e=$(r,t);return e*e}function $(r,t){return N*r/t}function j(r,t,e,i,s){const a=e.getFill(),n=e.getStroke();if(a||n){const l=r.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(a,n),l.drawCircle(t,i,s)}const o=e.getText();if(o&&o.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i)}}function ft(r,t,e,i,s,a,n,o){const l=[],h=e.getImage();if(h){let x=!0;const g=h.getImageState();g==u.LOADED||g==u.ERROR?x=!1:g==u.IDLE&&h.load(),x&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const f=l.length>0;return f&&Promise.all(l).then(()=>s(null)),K(r,t,e,i,a,n,o),f}function K(r,t,e,i,s,a,n){const o=e.getGeometryFunction()(t);if(!o)return;const l=o.simplifyTransformed(i,s);if(e.getRenderer())B(r,l,e,t,n);else{const c=W[l.getType()];c(r,l,e,t,n,a)}}function B(r,t,e,i,s){if(t.getType()=="GeometryCollection"){const n=t.getGeometries();for(let o=0,l=n.length;o<l;++o)B(r,n[o],e,i,s);return}r.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),s)}function Q(r,t,e,i,s,a){const n=t.getGeometriesArray();let o,l;for(o=0,l=n.length;o<l;++o){const h=W[n[o].getType()];h(r,n[o],e,i,s,a)}}function tt(r,t,e,i,s){const a=e.getStroke();if(a){const o=r.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,a),o.drawLineString(t,i,s)}const n=e.getText();if(n&&n.getText()){const o=r.getBuilder(e.getZIndex(),"Text");o.setTextStyle(n),o.drawText(t,i,s)}}function et(r,t,e,i,s){const a=e.getStroke();if(a){const o=r.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,a),o.drawMultiLineString(t,i,s)}const n=e.getText();if(n&&n.getText()){const o=r.getBuilder(e.getZIndex(),"Text");o.setTextStyle(n),o.drawText(t,i,s)}}function it(r,t,e,i,s){const a=e.getFill(),n=e.getStroke();if(n||a){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(a,n),l.drawMultiPolygon(t,i,s)}const o=e.getText();if(o&&o.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i,s)}}function nt(r,t,e,i,s,a){const n=e.getImage(),o=e.getText(),l=o&&o.getText(),h=a&&n&&l?{}:void 0;if(n){if(n.getImageState()!=u.LOADED)return;const c=r.getBuilder(e.getZIndex(),"Image");c.setImageStyle(n,h),c.drawPoint(t,i,s)}if(l){const c=r.getBuilder(e.getZIndex(),"Text");c.setTextStyle(o,h),c.drawText(t,i,s)}}function st(r,t,e,i,s,a){const n=e.getImage(),o=n&&n.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=a&&o&&h?{}:void 0;if(o){if(n.getImageState()!=u.LOADED)return;const f=r.getBuilder(e.getZIndex(),"Image");f.setImageStyle(n,c),f.drawMultiPoint(t,i,s)}if(h){const f=r.getBuilder(e.getZIndex(),"Text");f.setTextStyle(l,c),f.drawText(t,i,s)}}function ot(r,t,e,i,s){const a=e.getFill(),n=e.getStroke();if(a||n){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(a,n),l.drawPolygon(t,i,s)}const o=e.getText();if(o&&o.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i,s)}}function at(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=r.inversePixelTransform[0],e=r.inversePixelTransform[1],i=Math.sqrt(t*t+e*e),s=r.frameState,a=X(r.inversePixelTransform.slice(),s.coordinateToPixelTransform),n=U(s.viewState.resolution,i);let o;return new z(r.context,i,s.extent,a,s.viewState.rotation,n,o)}const lt={blue:[{type:"grayscale",value:"98%"},{type:"invert",value:"100%"},{type:"sepia",value:"20%"},{type:"hue-rotate",value:"180deg"},{type:"saturate",value:"1600%"},{type:"brightness",value:"80%"},{type:"contrast",value:"90%"}]},gt=r=>{const{layerToBeClipped:t,clipLayer:e}=r,i=e.getSource();if(!i)throw new Error("clipLayer source not found");i.on("addfeature",function(){console.log(i.getExtent()),t.setExtent(i.getExtent())});const s=new Z({fill:new V({color:"rgba(0,0,0,0)"})});t.on("prerender",function(a){let n=at(a);a.context.globalCompositeOperation="source-over";let o=a.context;o.save(),i.forEachFeature(function(l){n.drawFeature(l,s)}),o.clip()}),t.on("postrender",function(a){a.context.restore()})},rt=r=>{const{layer:t,filterFunction:e}=r,i=a=>(n,o)=>{const l=new Image;l.setAttribute("crossOrigin","anonymous"),l.onload=function(){const h=document.createElement("canvas"),c=l.width,f=l.height;h.width=c,h.height=f;const x=h.getContext("2d");x&&(a(x).drawImage(l,0,0,c,f,0,0,c,f),n.getImage().src=h.toDataURL("image/png"))},l.src=o},s=t.getSource();s.setTileLoadFunction(i(e)),t.setSource(s)},xt=r=>{const{layer:t,filterOptions:e=lt.blue}=r;rt({layer:t,filterFunction:s=>(s.filter=e.map(({type:a,value:n})=>`${a}(${n})`).join(" "),s)})};export{z as C,H as V,lt as a,$ as b,gt as c,ct as d,xt as f,U as g,ft as r};
