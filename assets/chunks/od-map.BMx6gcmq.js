import{b as x,V as _,a as B,G as C,S as k}from"./index.CXKZS7CZ.js";import{l as y}from"./index.C7-Tf2T7.js";import{p as D,v as E,b as q,o as f,w as L,j as m,c as v,F as P,B as G,k as I,N as A,t as g}from"./framework.BufGfe89.js";function F(e){return e.type==="Feature"?e.geometry:e}var N=class{constructor(e){this.points=e.points||[],this.duration=e.duration||1e4,this.sharpness=e.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=e.stepLength||60,this.length=this.points.length,this.delay=0;for(let t=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(let t=0;t<this.length-1;t++){const s=this.points[t],o=this.points[t+1];this.centers.push({x:(s.x+o.x)/2,y:(s.y+o.y)/2,z:(s.z+o.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(let t=0;t<this.centers.length-1;t++){const s=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,o=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,r=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+s),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+r)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+s),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+r)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}cacheSteps(e){const t=[];let s=this.pos(0);t.push(0);for(let o=0;o<this.duration;o+=10){const r=this.pos(o);Math.sqrt((r.x-s.x)*(r.x-s.x)+(r.y-s.y)*(r.y-s.y)+(r.z-s.z)*(r.z-s.z))>e&&(t.push(o),s=r)}return t}vector(e){const t=this.pos(e+10),s=this.pos(e-10);return{angle:180*Math.atan2(t.y-s.y,t.x-s.x)/3.14,speed:Math.sqrt((s.x-t.x)*(s.x-t.x)+(s.y-t.y)*(s.y-t.y)+(s.z-t.z)*(s.z-t.z))}}pos(e){let t=e-this.delay;t<0&&(t=0),t>this.duration&&(t=this.duration-1);const s=t/this.duration;if(s>=1)return this.points[this.length-1];const o=Math.floor((this.points.length-1)*s),r=(this.length-1)*s-o;return $(r,this.points[o],this.controls[o][1],this.controls[o+1][0],this.points[o+1])}};function $(e,t,s,o,r){const n=V(e);return{x:r.x*n[0]+o.x*n[1]+s.x*n[2]+t.x*n[3],y:r.y*n[0]+o.y*n[1]+s.y*n[2]+t.y*n[3],z:r.z*n[0]+o.z*n[1]+s.z*n[2]+t.z*n[3]}}function V(e){const t=e*e;return[t*e,3*t*(1-e),3*e*(1-e)*(1-e),(1-e)*(1-e)*(1-e)]}function X(e,t={}){const s=t.resolution||1e4,o=t.sharpness||.85,r=[],n=F(e).coordinates.map(c=>({x:c[0],y:c[1]})),a=new N({duration:s,points:n,sharpness:o}),i=c=>{var l=a.pos(c);Math.floor(c/100)%2===0&&r.push([l.x,l.y])};for(var h=0;h<a.duration;h+=10)i(h);return i(a.duration),y(r,t.properties)}const Y=(e,t,s=15)=>{const[o,r]=e,[n,a]=t,i=Math.sqrt((n-o)*(n-o)+(a-r)*(a-r)),h=(n-o)/i,c=(a-r)/i,l=-c,u=h,p=Math.cos(Math.PI/(180/s)),d=Math.sin(Math.PI/(180/s)),M=o+i/2*p*h-i/2*d*l,w=r+i/2*p*c-i/2*d*u,S=o+i/2*p*h+i/2*d*l,b=r+i/2*p*c+i/2*d*u;return[[M,w],[S,b]]},O=(e,t,s=15,o={})=>{const r=y([e,Y(e,t,s)[1],t]),n=X(r);return n.properties=o,n},j=e=>{const{data:t,curvature:s,style:o=x.default(),dataProjection:r="EPSG:4326",featureProjection:n="EPSG:3857"}=e;return new _({source:new B({features:t.map(a=>{let{from:i,to:h}=a;return new C({dataProjection:r,featureProjection:n}).readFeature(O(i,h,s,a))})}),style:o})},z={morandi:["#D77B7B","#D89B6A","#E3D28D","#A8CBA0","#A0D2E8","#7C9ED9","#A57BBE"]},J=(e=z.morandi)=>{const t=document.createElement("canvas"),s=t.getContext("2d");if(!s)throw new Error("Can't create gradient");const o=s.createLinearGradient(0,0,t.width,0);return e.forEach((r,n)=>{o.addColorStop(n/(e.length-1),r)}),s.fillStyle=o,s.fillRect(0,0,t.width,t.height),t},R=(e,t,s)=>{const o=e.getContext("2d");if(!o)throw new Error("Can't get gradient");const r=o.getImageData((e.width-1)*t/(s-1),e.height/2,1,1);return`rgba(${r.data[0]}, ${r.data[1]}, ${r.data[2]}, ${r.data[3]})`},T=(e,t)=>{const s=Math.min(...e),r=(Math.max(...e)-s)/t,n=[];for(let a=0;a<=t;a++)n.push(s+a*r);return n},H=(e,t)=>{const s=[...e].sort((n,a)=>n-a),o=[],r=s.length/t;for(let n=0;n<t;n++)o.push(s[Math.floor(n*r)]);return o.push(s[s.length-1]),o},K=(e,t)=>{const s=e.reduce((a,i)=>a+i,0)/e.length,o=e.reduce((a,i)=>a+Math.pow(i-s,2),0)/e.length,r=Math.sqrt(o),n=[];for(let a=-t;a<=t;a++)n.push(s+a*r);return n},Q=e=>{const{data:t,gradingMethod:s="equalInterval",gradingNum:o=5,colors:r=z.morandi}=e;let n;switch(s){case"equalInterval":n=T(t,o);break;case"quantile":n=H(t,o);break;case"stdDev":n=K(t,o);break;default:throw new Error(`Can't create legend: ${s}`)}n[n.length-1]=n[n.length-1]+1;const a=J(r),i=[];for(let h=0;h<n.length-1;h++)i.push({min:n[h],max:n[h+1],color:R(a,h,o)});return i},U={class:"absolute left-0 bottom-0 z-5 text-xs"},W={class:"flex items-center gap-xs"},Z={class:"label"},ot={__name:"od-map",setup(e){const t=D(),s={北京:[116.407526,39.90403],上海:[121.4737,31.2304],天津:[117.200983,39.084158],重庆:[106.50496,29.533155],河北:[114.514945,38.046825],山西:[112.54924,37.857133],辽宁:[123.42906,41.83544],吉林:[125.3245,43.88684],黑龙江:[126.64466,45.756967],江苏:[118.767413,32.041482],浙江:[120.15506,30.274105],安徽:[117.283933,31.86119],福建:[119.30595,26.075302],江西:[115.85847,28.682965],山东:[117.000929,36.653942],河南:[113.783406,34.747005],湖北:[114.305469,30.592804],湖南:[112.982279,28.19409],广东:[113.2304,23.1616],广西:[108.32754,22.824022],海南:[110.349216,20.017469],四川:[104.075832,30.65166],贵州:[106.630129,26.64227],云南:[102.712249,25.040609],陕西:[108.948583,34.26335],甘肃:[103.834329,36.05808],青海:[101.778129,36.623178],台湾:[121.305416,25.033052],内蒙古:[111.670462,40.818467],广西壮族自治区:[108.32754,22.824022],宁夏回族自治区:[106.225183,38.48637],新疆维吾尔自治区:[87.61618,43.825784],西藏自治区:[91.11741,29.646938],香港特别行政区:[114.169363,22.395262],澳门特别行政区:[113.543883,22.198745]},o=[{from:"北京",to:"浙江",value:120},{from:"上海",to:"浙江",value:150},{from:"天津",to:"浙江",value:80},{from:"重庆",to:"浙江",value:90},{from:"河北",to:"浙江",value:100},{from:"山西",to:"浙江",value:60},{from:"辽宁",to:"浙江",value:70},{from:"吉林",to:"浙江",value:50},{from:"黑龙江",to:"浙江",value:40},{from:"江苏",to:"浙江",value:180},{from:"安徽",to:"浙江",value:110},{from:"福建",to:"浙江",value:90},{from:"江西",to:"浙江",value:85},{from:"山东",to:"浙江",value:130},{from:"河南",to:"浙江",value:140},{from:"湖北",to:"浙江",value:100},{from:"湖南",to:"浙江",value:95},{from:"广东",to:"浙江",value:160},{from:"广西",to:"浙江",value:70},{from:"海南",to:"浙江",value:30},{from:"四川",to:"浙江",value:120},{from:"贵州",to:"浙江",value:80},{from:"云南",to:"浙江",value:75},{from:"陕西",to:"浙江",value:90},{from:"甘肃",to:"浙江",value:55},{from:"青海",to:"浙江",value:45},{from:"台湾",to:"浙江",value:20},{from:"内蒙古",to:"浙江",value:65},{from:"广西壮族自治区",to:"浙江",value:70},{from:"宁夏回族自治区",to:"浙江",value:50},{from:"新疆维吾尔自治区",to:"浙江",value:40},{from:"西藏自治区",to:"浙江",value:35},{from:"香港特别行政区",to:"浙江",value:25},{from:"澳门特别行政区",to:"浙江",value:20}],r=o.map(a=>({from:s[a.from],to:s[a.to],value:a.value})),n=Q({data:o.map(a=>a.value),gradingMethod:"equalInterval",gradingNum:5});return E(()=>{const a=t.value.map(),i=j({data:r,style:h=>{const c=h.get("value"),l=n.find(u=>u.min<=c&&u.max>c).color;return x.default({color:l})}});a.addLayer(i)}),(a,i)=>(f(),q(k,{ref_key:"refSimpleMap",ref:t,adcode:1e5},{default:L(()=>[m("div",U,[(f(!0),v(P,null,G(I(n),h=>(f(),v("div",W,[m("div",{class:"h-2.5 w-2.5 rounded-full",style:A({background:h.color})},null,4),m("div",Z,g(h.min)+" - "+g(h.max),1)]))),256))])]),_:1},512))}};export{ot as default};
